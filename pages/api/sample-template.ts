import { NextApiRequest, NextApiResponse } from "next";
import fs from "fs";
import path from "path";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== "GET") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    // Create a simple sample template image by copying an existing image
    // or creating a base64 PNG data URL
    const sampleImageBase64 = "data:image/png;base64,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";

    const outputDir = path.join(process.cwd(), "public", "temp_images");
    if (!fs.existsSync(outputDir)) {
      fs.mkdirSync(outputDir, { recursive: true });
    }

    const timestamp = Date.now();
    const pngFilename = `sample_template_${timestamp}.png`;
    const pngPath = `/temp_images/${pngFilename}`;
    
    // Convert base64 to buffer and save
    const base64Data = sampleImageBase64.replace(/^data:image\/png;base64,/, "");
    const imageBuffer = Buffer.from(base64Data, 'base64');
    
    fs.writeFileSync(path.join(outputDir, pngFilename), imageBuffer);

    res.status(200).json({
      success: true,
      imageUrl: pngPath,
      message: "Sample template ready to use!"
    });

  } catch (error) {
    console.error("Error generating sample template:", error);
    res.status(500).json({ error: "Failed to generate sample template" });
  }
}